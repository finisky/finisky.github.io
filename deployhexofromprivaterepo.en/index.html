<!DOCTYPE html>
<html lang="en">
<head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-K4DEGPDYSW"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag("js", new Date()); gtag("config", "G-K4DEGPDYSW"); </script><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.png" color="#222">
  <meta name="google-site-verification" content="oFhcvcGsjsTY5AFUaI-ezbn7-bel9NrdUNpeQfwZSwI">
  <meta name="msvalidate.01" content="F8E2F274161B653649F8818FD127CE87">
  <meta name="yandex-verification" content="f6d91994ba785a63">
  <meta name="baidu-site-verification" content="code-nNL5JO7sPl">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"finisky.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Last time we talked how to deploy Hugo from private repository to GitHub Pages . I thought it is trivial to modify the workflow yaml to make it works for Hexo. However, it is much more complicated tha">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy Hexo From Private Repository to GitHub Pages">
<meta property="og:url" content="https://finisky.github.io/deployhexofromprivaterepo.en/index.html">
<meta property="og:site_name" content="Finisky Garden">
<meta property="og:description" content="Last time we talked how to deploy Hugo from private repository to GitHub Pages . I thought it is trivial to modify the workflow yaml to make it works for Hexo. However, it is much more complicated tha">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://coriva.eu.org/images/hexodeployaction.png">
<meta property="article:published_time" content="2022-05-02T06:02:15.000Z">
<meta property="article:modified_time" content="2023-01-24T14:30:12.000Z">
<meta property="article:author" content="finisky">
<meta property="article:tag" content="Hexo">
<meta property="article:tag" content="Hugo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://coriva.eu.org/images/hexodeployaction.png">


<link rel="canonical" href="https://finisky.github.io/deployhexofromprivaterepo.en/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://finisky.github.io/deployhexofromprivaterepo.en/","path":"deployhexofromprivaterepo.en/","title":"Deploy Hexo From Private Repository to GitHub Pages"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Deploy Hexo From Private Repository to GitHub Pages | Finisky Garden</title>
  







<link rel="dns-prefetch" href="https://comments.finisky.eu.org">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><script type="text/javascript"> function downloadJsAtOnload() { setTimeout(function downloadJs() { var element = document.createElement("script"); element.setAttribute("data-ad-client", "ca-pub-2660281922577700"); element.async = true; element.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"; document.body.appendChild(element); }, 5000); }; if (window.addEventListener) window.addEventListener("load", downloadJsAtOnload, false); else if (window.attachEvent) window.attachEvent("onload", downloadJsAtOnload); else window.onload = downloadJsAtOnload; </script><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Finisky Garden" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Finisky Garden</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">NLP, 软件工程, 产品设计</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-nlp"><a href="/tags/NLP/" rel="section"><i class="fa fa-language fa-fw"></i>NLP</a></li><li class="menu-item menu-item-mongodb"><a href="/categories/MongoDB/" rel="section"><i class="fas fa-database fa-fw"></i>MongoDB</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-友链"><a href="/links/" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-关于"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#github-action-workflow-yaml-for-hexo"><span class="nav-number">1.</span> <span class="nav-text">GitHub Action Workflow
Yaml for Hexo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#setup-the-theme-submodule"><span class="nav-number">2.</span> <span class="nav-text">Setup the Theme Submodule</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#create-personal-access-token"><span class="nav-number">3.</span> <span class="nav-text">Create Personal Access Token</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#configure-the-pat-as-a-secret-in-source-repo"><span class="nav-number">4.</span> <span class="nav-text">Configure the PAT
as a Secret in Source Repo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#create-deploy-key"><span class="nav-number">5.</span> <span class="nav-text">Create Deploy Key</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#install-pandoc-for-mathjax-optional"><span class="nav-number">6.</span> <span class="nav-text">Install Pandoc for mathjax
(Optional)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#checkout-submodule-in-github-actions"><span class="nav-number">7.</span> <span class="nav-text">Checkout Submodule in
GitHub Actions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#two-ways-to-deploy-hexo-artifacts"><span class="nav-number">8.</span> <span class="nav-text">Two Ways to Deploy Hexo
Artifacts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#summary"><span class="nav-number">9.</span> <span class="nav-text">Summary</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="finisky"
      src="/images/qrcode.jpg">
  <p class="site-author-name" itemprop="name">扫码关注公众号</p>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">211</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    Related Posts
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/deployhugofromprivaterepo.en/" rel="bookmark">
        <time class="popular-posts-time">2022-04-26</time>
        <br>
      Deploy Hugo From Private Repository to GitHub Pages
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/deployhexofromprivaterepo/" rel="bookmark">
        <time class="popular-posts-time">2022-05-02</time>
        <br>
      从私有代码库自动部署Hexo站到GitHub Pages
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/deployhugofromprivaterepo/" rel="bookmark">
        <time class="popular-posts-time">2022-04-26</time>
        <br>
      从私有代码库自动部署Hugo站到GitHub Pages
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/githubactiontorestorefilemtime.en/" rel="bookmark">
        <time class="popular-posts-time">2022-05-15</time>
        <br>
      GitHub Checkout Action Preserve File Modification Time
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/multiplegithubaccountsononemachine.en/" rel="bookmark">
        <time class="popular-posts-time">2021-11-03</time>
        <br>
      Confgure Multiple Github Accounts On One Machine
      </a>
    </li>
  </ul>

          </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://finisky.github.io/deployhexofromprivaterepo.en/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qrcode.jpg">
      <meta itemprop="name" content="finisky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finisky Garden">
      <meta itemprop="description" content="互联网那些事儿：NLP, 软件工程, 产品设计">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Deploy Hexo From Private Repository to GitHub Pages | Finisky Garden">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Deploy Hexo From Private Repository to GitHub Pages
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-02 14:02:15" itemprop="dateCreated datePublished" datetime="2022-05-02T14:02:15+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-24 22:30:12" itemprop="dateModified" datetime="2023-01-24T22:30:12+08:00">2023-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">评论: </span>
  
    <a title="waline" href="/deployhexofromprivaterepo.en/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/deployhexofromprivaterepo.en/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-item" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="waline-pageview-count" data-path="/deployhexofromprivaterepo.en/"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Last time we talked <a href="/deployhugofromprivaterepo.en/">how to
deploy Hugo from private repository to GitHub Pages</a> . I thought it
is trivial to modify the workflow yaml to make it works for Hexo.
However, it is much more complicated than I ever thought. The reason is
that Hexo has to setup more dependencies with compatibility issues while
Hugo is relatively self-contained and clean.</p>
<p>Actually, I spent several hours and attempted more than 20 times to
make the workflow yaml works. :-)</p>
<p>Compared to Hugo workflow, there are several issues to be
resolved:</p>
<ul>
<li>Setup private submodules for your themes</li>
<li>Configure PAT to pull private submodules as well as your main
repo</li>
<li>Pandoc installation for mathjax (optional)</li>
</ul>
<p>Let's start!</p>
<span id="more"></span>
<p>Typically, assume you have three repos (can belong to different
github accounts). Without loss of generality, we assume the source repo,
the target repo and the theme submodule repo are belong to the SAME
github account.</p>
<ul>
<li>Source Repo (private): store the source code</li>
<li>Theme Repo (private): store the modified theme source code</li>
<li>Target Repo (public): host the GitHub Pages (xxx.github.io)</li>
</ul>
<p>What we need to do is to create an account-level personal access
token in the github account, configure it in the source repo and create
an action workflow yaml.</p>
<h1 id="github-action-workflow-yaml-for-hexo">GitHub Action Workflow
Yaml for Hexo</h1>
<p>We will take a top-down approach for this tutorial. See the workflow
yaml first:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Hexo Build &amp; Deploy <span class="token punctuation">-</span> Private to Public

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> master <span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3.0.0
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">token</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> secrets.MYPAT <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">submodules</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
        <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Prepare Node env
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token number">16</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install pandoc
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        cd /tmp
        wget -c https://github.com/jgm/pandoc/releases/download/2.14.0.3/pandoc-2.14.0.3-1-amd64.deb
        sudo dpkg -i pandoc-2.14.0.3-1-amd64.deb</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hexo
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        pandoc --version
        npm i -g hexo-cli
        npm i
        hexo clean &amp;&amp; hexo g</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@v4.3.3
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssh-key</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> secrets.DEPLOY_KEY <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">repository-name</span><span class="token punctuation">:</span> finisky/finisky.github.io
        <span class="token key atrule">branch</span><span class="token punctuation">:</span> master <span class="token comment"># The branch the action should deploy to.</span>
        <span class="token key atrule">folder</span><span class="token punctuation">:</span> public <span class="token comment"># The folder the action should deploy.</span>
        <span class="token key atrule">single-commit</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">commit-message</span><span class="token punctuation">:</span> <span class="token string">"Deploy by source"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The action workflow consists of the following parts:</p>
<ul>
<li>Checkout: checkout the source code as well as submodules</li>
<li>Setup Node Env: setup node environment</li>
<li>Install pandoc for mathjax (Optional): if your use pandoc and
mathjax to render math formulas</li>
<li>Setup and Run Hexo: build the static website</li>
<li>Deploy: use <a
target="_blank" rel="noopener" href="https://github.com/JamesIves/github-pages-deploy-action"># GitHub
Pages Deploy Action</a> to publish the website to the target GitHub
Page</li>
</ul>
<p>The action workflow yaml is based on: <a
target="_blank" rel="noopener" href="https://blog.euc-rt.me/post/github-actions-publish-private-hugo-repo-to-public-pages-site/">#
Using GitHub Actions to Publish Hugo Site From Private to Public
Repo</a>. Modify according to your needs, create a new workflow action
in the source repo by <code>Setup a workflow yourself</code> and paste
it into the editor. The yaml should be put in the path:
<code>.github/workflows/main.yml</code>.</p>
<p>Next steps:</p>
<ul>
<li>Setup the theme submodule</li>
</ul>
<p>Fill the following fields in the above yaml:</p>
<ul>
<li><code>token: $&#123;&#123; secrets.MYPAT &#125;&#125;</code>: change the secret name to
the PAT secret name</li>
<li><code>ssh-key: $&#123;&#123; secrets.DEPLOY_KEY &#125;&#125;</code>: create a deploy key to
push the built site HTML to the target repo</li>
<li><code>repository-name: xxx/xxx.github.io</code>: the target GitHub
Page repository address</li>
</ul>
<h1 id="setup-the-theme-submodule">Setup the Theme Submodule</h1>
<p>The recommended way to manage Hexo themes is to use git submodule.
However, there are several considerations:</p>
<ul>
<li>Save your customized theme config</li>
<li>Theme upgrade is tough and complicated (merge and resolve conflicts
for breaking change)</li>
</ul>
<p>The easier way to bypass the submodule issue is NOT use it. Just
remove the theme's <code>.git</code> folder and checkin it to the source
repo. However, it's hard to follow the latest theme version and
upgrade.</p>
<p>Here, we choose to FORK the theme repo to our own private repo. Use
two branches to manage it: the main branch can be fast-forwarded to the
latest official version, while the <code>v8.5</code> branch holds our
customized changes.</p>
<p>General add submodule command:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> submodule <span class="token function">add</span> <span class="token parameter variable">-b</span> master <span class="token operator">&lt;</span>git@github.com:MYSUBMODULE.git<span class="token operator">></span> <span class="token operator">&lt;</span>path/to/MYSUBMODULE<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This creates the submodule and makes it track submodule's
<code>master</code> branch. You can change the branch name if you want
to track a different branch.</p>
<p>Now we setup the submodule as follow:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> remote <span class="token function">add</span> mythemenext git@github.com:finisky/mythemenext
<span class="token function">git</span> submodule <span class="token function">add</span> <span class="token parameter variable">-b</span> v8.5 https://github.com/finisky/mythemenext themes/next/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>If you encounter:
<code>'themes/next' already exists in the index</code> . Add option
<code>--force</code> after <code>git submodule add</code>.</p>
<p>References for this topic:</p>
<p><a
target="_blank" rel="noopener" href="https://blog.singee.me/2020/02/15/deploy-hexo-with-github-action/">利用
Github Action 部署 Hexo</a> <a
target="_blank" rel="noopener" href="https://achillessatan.github.io/posts/54991/">How to Setup Blog
with Hexo and NexT on GitHub Pages</a></p>
<h1 id="create-personal-access-token">Create Personal Access Token</h1>
<blockquote>
<p>Personal access tokens (PATs) are an alternative to using passwords
for authentication to GitHub Enterprise Server when using the GitHub API
or the command line.</p>
</blockquote>
<p>We will use the PAT to push the built hugo website from the source
repo to the target repo.</p>
<p>Just follow <a
target="_blank" rel="noopener" href="https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">this
post</a> to generate a PAT:</p>
<blockquote>
<p>Profile Photo -&gt; Settings -&gt; Developer settings -&gt; Personal
access tokens -&gt; Generate new token</p>
</blockquote>
<p>Remember to check the following two scopes: <code>workflow</code> and
<code>write:packages</code>.</p>
<p>Copy the token and properly save it, assume its value is
<code>TOKENXXX</code>.</p>
<p>Notice that the PAT is an account-level token, deploy key is
recommended to use as a repo-level token. Here we MUST use the PAT to
pull the website source code as well as the submodule code.</p>
<h1 id="configure-the-pat-as-a-secret-in-source-repo">Configure the PAT
as a Secret in Source Repo</h1>
<p>Go to the source repo: &gt; Settings -&gt; Secrets -&gt; Actions
-&gt; New repository secret</p>
<p>Paste the token created before <code>TOKENXXX</code> to the value
field. Name the secret as <code>MYPAT</code>.</p>
<h1 id="create-deploy-key">Create Deploy Key</h1>
<p><strong>Tips</strong>: You can SKIP this step and use the PAT to
deploy the websites. Just replace
<code>ssh-key: $&#123;&#123; secrets.DEPLOY_KEY &#125;&#125;</code> by
<code>token: $&#123;&#123; secrets.MYPAT &#125;&#125;</code> . But deploy key is
<strong>recommended</strong>.</p>
<p>Follow <a
target="_blank" rel="noopener" href="https://docs.github.com/en/developers/overview/managing-deploy-keys#deploy-keys">this
post</a> and <a
target="_blank" rel="noopener" href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key">this</a>
to create a deploy key:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ssh-keygen <span class="token parameter variable">-t</span> ed25519 <span class="token parameter variable">-C</span> <span class="token string">"your_email@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Follow <a
target="_blank" rel="noopener" href="https://cyfeng.science/2020/12/02/use-github-action-to-automatically-deploy-hexo/">this
post</a> to add the deploy key to the source repo:</p>
<blockquote>
<p>Once you've generated the key pair you must add the contents of the
public key within your repository's <a
target="_blank" rel="noopener" href="https://developer.github.com/v3/guides/managing-deploy-keys/">deploy
keys menu</a>. You can find this option by going to
<code>Settings &gt; Deploy Keys</code>, you can name the public key
whatever you want, but you <strong>do</strong> need to give it write
access. Afterwards, add the contents of the private key to the
<code>Settings &gt; Secrets</code> menu as <code>DEPLOY_KEY</code>.</p>
</blockquote>
<h1 id="install-pandoc-for-mathjax-optional">Install Pandoc for mathjax
(Optional)</h1>
<p>You may encounter the following error:</p>
<blockquote>
<p>Error: R][hexo-renderer-pandoc] pandoc exited with code null.</p>
</blockquote>
<p>If you use pandoc and mathjax to render formulas, the following
workflow step is mandatory (modify the pandoc version to your
environment). Otherwise, just remove this part and
<code>pandoc --version</code> in the next part:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install pandoc
  <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    cd /tmp
    wget -c https://github.com/jgm/pandoc/releases/download/2.14.0.3/pandoc-2.14.0.3-1-amd64.deb
    sudo dpkg -i pandoc-2.14.0.3-1-amd64.deb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>If you encounter the following error:</p>
<blockquote>
<p>Error: R][hexo-renderer-pandoc] pandoc exited with code 64: YAML
parse exception at line 4, column 0, while scanning a simple key: could
not find expected ':'</p>
</blockquote>
<p>It's pandoc version compatibility issue, try to modify the above
<code>wget</code> command to use the same version as in your local
environment. Refer to <a href="/pandoccode64bug.en/"># pandoc exited
with code 64 Solution</a>.</p>
<hr />
<p>The trick is that we cannot use the official document docker file
like this: <a target="_blank" rel="noopener" href="https://github.com/pandoc/pandoc-action-example">#
Using pandoc with GitHub Actions</a></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>//pandoc/core<span class="token punctuation">:</span><span class="token number">2.9</span>
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token string">"--help"</span> <span class="token comment"># gets appended to pandoc command</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Because the <code>pandoc</code> command will be used in the next step
<code>Setup and Run Hexo to build the Static Site</code>.</p>
<p>Therefore, we follow this post <a
target="_blank" rel="noopener" href="https://pxxyyz.com/posts/hexo-problem/">Hexo之问题集合</a> and use
<code>dpkg</code> to install the pandoc globally.</p>
<h1 id="checkout-submodule-in-github-actions">Checkout Submodule in
GitHub Actions</h1>
<p>If you see many warn messages in step <code>Hexo</code>:</p>
<blockquote>
<p>WARN No layout: tags/index.html WARN No layout:
nlpadapters/index.html WARN No layout:
deployhugofromprivaterepo/index.html</p>
</blockquote>
<p>Probably the submodule <code>themes/next</code> are not correctly
pulled. By default, the submodule will not be pulled. Need to add
<code>submodules: 'true'</code>.</p>
<p>We follow this post <a
target="_blank" rel="noopener" href="https://samuelsson.dev/access-private-submodules-in-github-actions/">#
Access private submodules in GitHub Actions</a> to use a deploy key to
pull the submodule. Unfortunately, the following error appears:</p>
<blockquote>
<p>Run actions/checkout@v2.3.4 Syncing repository:
finisky/finiskyblogsource ... Fetching the repository Removing auth
Error: The process '/usr/bin/git' failed with exit code 128</p>
</blockquote>
<p>Seems that the main repo <code>finisky/finiskyblogsource</code>
cannot be properly pulled because <strong>the main repo and the
submodule repo should have the same deploy key</strong>. However, we
failed to add the same deploy key to the main repo as GitHub said it's
already been used.</p>
<p>Therefore, we can only use PAT to pull the main repo and the
submodule repo at the same time. Modify the checkout part like this:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
  <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3.0.0
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
    <span class="token key atrule">token</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> secrets.MYPAT <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
    <span class="token key atrule">submodules</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
    <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="two-ways-to-deploy-hexo-artifacts">Two Ways to Deploy Hexo
Artifacts</h1>
<p>Look at steps:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hexo
  <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    pandoc --version
    npm i -g hexo-cli
    npm i
    hexo clean &amp;&amp; hexo g</span>

<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy
  <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@v4.3.3
  <span class="token punctuation">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Actually, there are two ways to deploy artifacts:</p>
<ul>
<li><code>hexo deploy</code> in step
<code>Setup and Run Hexo to build the Static Site</code></li>
<li><code>github-pages-deploy-action</code> as we used</li>
</ul>
<p>We choose the second way to keep it consistent with Hugo deploy
action.</p>
<h1 id="summary">Summary</h1>
<p>Congratulations!</p>
<p>After you push the source code to the source repo, the deployment
action will be triggered:</p>
<p><img src="https://coriva.eu.org/images/hexodeployaction.png"
alt="Hexo Deployment Action" /></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Hexo/" rel="tag"># Hexo</a>
              <a href="/tags/Hugo/" rel="tag"># Hugo</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/nlpadapters/" rel="prev" title="NLP中的Adapters是什么？">
                  <i class="fa fa-chevron-left"></i> NLP中的Adapters是什么？
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/deployhexofromprivaterepo/" rel="next" title="从私有代码库自动部署Hexo站到GitHub Pages">
                  从私有代码库自动部署Hexo站到GitHub Pages <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">finisky</span>
</div><div><span class="post-meta-item-icon"><i class="far fa-eye"></i></span><span><a href="https://finicounter.eu.org/" target="_blank">Total Views</a>:</span><span id="finicount_views" style="display:inline;padding-left:5px;"></span><div> <script async src="//finicounter.eu.org/finicounter.js"></script>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/finisky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"en-US","enable":true,"serverURL":"https://comments.finisky.eu.org","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":true,"pageSize":10,"el":"#waline","comment":true,"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","path":"/deployhexofromprivaterepo.en/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body>
</html>
