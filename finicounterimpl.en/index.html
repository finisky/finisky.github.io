<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/avatar.png" color="#222">
  <meta name="google-site-verification" content="oFhcvcGsjsTY5AFUaI-ezbn7-bel9NrdUNpeQfwZSwI">
  <meta name="msvalidate.01" content="F8E2F274161B653649F8818FD127CE87">
  <meta name="yandex-verification" content="ff1f79abcbf80d7e">
  <meta name="baidu-site-verification" content="XG2u6IqsZb">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"finisky.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.5.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Static website such as Hexo&#x2F;Hugo&#x2F;Jekyll is very popular recent years. It is fast, easy to write, deploy and host. However, no free lunch: it is non-trivial to store dynamic information such as pagevie">
<meta property="og:type" content="article">
<meta property="og:title" content="FiniCounter: A Website Vistor Counter">
<meta property="og:url" content="https://finisky.github.io/finicounterimpl.en/index.html">
<meta property="og:site_name" content="Finisky Garden">
<meta property="og:description" content="Static website such as Hexo&#x2F;Hugo&#x2F;Jekyll is very popular recent years. It is fast, easy to write, deploy and host. However, no free lunch: it is non-trivial to store dynamic information such as pagevie">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-08-07T09:20:59.000Z">
<meta property="article:modified_time" content="2022-08-07T09:21:46.000Z">
<meta property="article:author" content="finisky">
<meta property="article:tag" content="Hexo">
<meta property="article:tag" content="MongoDB">
<meta property="article:tag" content="NexT">
<meta property="article:tag" content="Hexo Extension">
<meta property="article:tag" content="Hugo">
<meta property="article:tag" content="Serverless">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://finisky.github.io/finicounterimpl.en/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://finisky.github.io/finicounterimpl.en/","path":"finicounterimpl.en/","title":"FiniCounter: A Website Vistor Counter"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>FiniCounter: A Website Vistor Counter | Finisky Garden</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96909088-2"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-96909088-2","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>



<link rel="dns-prefetch" href="https://finiskycomments.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><script type="text/javascript"> function downloadJsAtOnload() { setTimeout(function downloadJs() { var element = document.createElement("script"); element.setAttribute("data-ad-client", "ca-pub-2660281922577700"); element.async = true; element.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"; document.body.appendChild(element); }, 5000); }; if (window.addEventListener) window.addEventListener("load", downloadJsAtOnload, false); else if (window.attachEvent) window.attachEvent("onload", downloadJsAtOnload); else window.onload = downloadJsAtOnload; </script><!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Finisky Garden</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Easy doesn't enter into grown-up life.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-nlp"><a href="/tags/NLP/" rel="section"><i class="fa fa-language fa-fw"></i>NLP</a></li>
        <li class="menu-item menu-item-mongodb"><a href="/categories/MongoDB/" rel="section"><i class="fas fa-database fa-fw"></i>MongoDB</a></li>
        <li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fas fa-link fa-fw"></i>Links</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#backend-implementation"><span class="nav-number">1.</span> <span class="nav-text">Backend Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#host-by-yourself"><span class="nav-number">1.1.</span> <span class="nav-text">Host By Yourself</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#frontend-implementation"><span class="nav-number">2.</span> <span class="nav-text">Frontend Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-use"><span class="nav-number">2.1.</span> <span class="nav-text">How to Use</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#basic-usage"><span class="nav-number">2.1.1.</span> <span class="nav-text">Basic Usage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hexo-next-theme-integration"><span class="nav-number">2.2.</span> <span class="nav-text">Hexo NexT Theme Integration</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#demo"><span class="nav-number">3.</span> <span class="nav-text">Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#source-code"><span class="nav-number">4.</span> <span class="nav-text">Source Code</span></a></li></ol></div>
            <div class="site-author site-overview-item animated">
              <img class="site-author-image" itemprop="image" alt="finisky" src="/images/qrcode.png" />
              <p class="site-author-name">扫码关注公众号</p>
            </div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="finisky"
      src="/images/qrcode.png">
  <p class="site-author-name">扫码关注公众号</p>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">175</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://finisky.github.io/finicounterimpl.en/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qrcode.png">
      <meta itemprop="name" content="finisky">
      <meta itemprop="description" content="Easy doesn't enter into grown-up life.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finisky Garden">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          FiniCounter: A Website Vistor Counter
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-08-07 17:20:59 / Modified: 17:21:46" itemprop="dateCreated datePublished" datetime="2022-08-07T17:20:59+08:00">2022-08-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Comments: </span>
  
    <a title="waline" href="/finicounterimpl.en/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/finicounterimpl.en/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-item" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="waline-pageview-count" data-path="/finicounterimpl.en/"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Static website such as Hexo/Hugo/Jekyll is very popular recent years.
It is fast, easy to write, deploy and host. However, no free lunch: it
is non-trivial to store dynamic information such as pageview counts and
comments under the serverless architecture. This site uses Waline to
implement article view count and comment system.</p>
<p>Accidently I found that we do not have a full site pageview counter.
Waline has post-level counter instead of site-level one.</p>
<p>Just DIY: FiniCounter. Use Vercel serverless function as the web API
framework, MongoDB as the storage. When a user comes to any page of the
site, we invoke the count API through fetch API, increment the counter
in the MongoDB, return the updated value and display in the page.</p>
<p>Initially I want to develop a tool for myself. After I finish it, I
decide to make it as a public <strong>free</strong> service :-) . <a
target="_blank" rel="noopener" href="https://finicounter.vercel.app/en">FiniCounter</a> looks like
this:</p>
<p><img
src="https://cdn.jsdelivr.net/gh/finisky/finicounter/finicounterdemo.en.png"
alt="FiniCounter Demo" /></p>
<span id="more"></span>
<h1 id="backend-implementation">Backend Implementation</h1>
<p>The backend logic is straightforward. The server received a Http GET
request and increment the corresponding count in MongoDB.</p>
<p>The API format:
<code>https://finicounter.vercel.app/counter?host=xxx.com</code></p>
<p>It uses domain name <code>host</code> as the key to count.</p>
<p>The main code is self-explained:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">MONGODB_URL <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"MONGODB_URL"</span><span class="token punctuation">)</span>
CORS_ORIGINS <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"CORS_ORIGINS"</span><span class="token punctuation">)</span>
DB_NAME <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"DB_NAME"</span><span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"DB_NAME"</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token string">"MyCounter"</span>
COLLECTION_NAME <span class="token operator">=</span> <span class="token string">"Counter"</span>

cors_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">:</span> CORS_ORIGINS<span class="token punctuation">,</span> <span class="token string">"Access-Control-Allow-Method"</span><span class="token punctuation">:</span> <span class="token string">"POST, GET, OPTIONS"</span><span class="token punctuation">&#125;</span>

mongoClient <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>MONGODB_URL<span class="token punctuation">)</span>
db <span class="token operator">=</span> mongoClient<span class="token punctuation">[</span>DB_NAME<span class="token punctuation">]</span>
collection<span class="token operator">=</span> db<span class="token punctuation">[</span>COLLECTION_NAME<span class="token punctuation">]</span>

app <span class="token operator">=</span> Sanic<span class="token punctuation">(</span><span class="token string">"finicounter"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/counter"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">counter</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    args <span class="token operator">=</span> request<span class="token punctuation">.</span>get_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    host <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token string">"host"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    result <span class="token operator">=</span> collection<span class="token punctuation">.</span>find_one_and_update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"host"</span><span class="token punctuation">:</span> host<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"$inc"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">"views"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"$set"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token string">"updateTime"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> upsert <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> return_document <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>ReturnDocument<span class="token punctuation">.</span>AFTER<span class="token punctuation">,</span> maxTimeMS<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"views"</span><span class="token punctuation">:</span> result<span class="token punctuation">[</span><span class="token string">'views'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> cors_headers<span class="token punctuation">)</span>


app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span> fast<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="host-by-yourself">Host By Yourself</h2>
<p>Host FiniCounter yourself is easy. What you need is a Vercel account
and a MongoDB.</p>
<p>Just fork <code>https://github.com/finisky/finicounter</code> to your
GitHub account, create a new project in Vercel, import the private
repository and configure 3 environment variables:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CORS_ORIGINS</td>
<td>* (or your domain)</td>
</tr>
<tr class="even">
<td>DB_NAME</td>
<td>MongoDB DB name</td>
</tr>
<tr class="odd">
<td>MONGODB_URL</td>
<td>MongoDB Connection String</td>
</tr>
</tbody>
</table>
<p>The data is stored in the <code>Counter</code> Collection of DB
<code>DB_NAME</code> .</p>
<p><img
src="https://cdn.jsdelivr.net/gh/finisky/finiskyimages/vercelenvsetting.png"
alt="Vercel Env Setting" /></p>
<h1 id="frontend-implementation">Frontend Implementation</h1>
<p>The fronted is implemented by fetch API. The <code>innerText</code>
of the element with id <code>finicount_views</code> will be set to the
retrieved counter value. The script:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">"https://finicounter.vercel.app/counter?host="</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">renderViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"finicount_views"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> elem <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> elem <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        elem<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token function">formatNumber</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>views<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">formatNumber</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\d)(?=(\d&#123;3&#125;)+(?!\d))</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"$1,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">renderViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The function <code>formatNumber</code> will format the counter like
<code>12,345,678</code> . Feel free to customize your own script if
necessary.</p>
<h2 id="how-to-use">How to Use</h2>
<h3 id="basic-usage">Basic Usage</h3>
<ol type="1">
<li>Add the following script to your websites:</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script <span class="token keyword">async</span> src<span class="token operator">=</span><span class="token string">"//finicounter.vercel.app/finicounter.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2" type="1">
<li>Add a container with id <code>finicount_views</code> to show the
view counts:</li>
</ol>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>finicount_views<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>You are done! The view count will be shown on your site like this
<code>12,345,678</code>.</p>
<p><strong>Notice</strong>: the script should be added to
<strong>every</strong> pages of your website. Otherwise, the page view
counter might missing counts.</p>
<p>It is also welcome to directly use the counter API
<code>https://finicounter.vercel.app/counter?host=xxx.com</code> and
customize the javascript yourself.</p>
<p><strong>Each counter will be automatically deleted if not accessed
for more than 3 months.</strong></p>
<h2 id="hexo-next-theme-integration">Hexo NexT Theme Integration</h2>
<p>For Hexo NexT theme, we can easily integrate FiniCounter by <a
target="_blank" rel="noopener" href="https://theme-next.js.org/docs/advanced-settings/injects">Injects</a>.
The total pageview can be displayed in the footer:</p>
<p><img
src="https://cdn.jsdelivr.net/gh/finisky/finiskyimages/nextpageviewfooter.png"
alt="FiniCounter Hexo NexT Demo" /></p>
<p>Just add a new js file <code>totalpageview.js</code> in the Hexo root
folder <code>scripts/</code>:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'theme_inject'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">injects</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  injects<span class="token punctuation">.</span>footer<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token string">'totalpageview'</span><span class="token punctuation">,</span> <span class="token string">'&lt;div>&lt;span>&lt;a href="https://finicounter.vercel.app/" target="_blank">Total Pageview:&lt;/a>&lt;/span>&lt;span id="finicount_views" style="display:inline;padding-left:5px;">&lt;/span>&lt;div> &lt;script async src="//finicounter.vercel.app/finicounter.js">&lt;/script>'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Leave Hexo NexT Plugin as future work :-) .</p>
<h1 id="demo">Demo</h1>
<p><a target="_blank" rel="noopener" href="https://finicounter.vercel.app/">Demo</a></p>
<p>This site is using FiniCounter :-) . <a href="/finicounter">Demo on
this site</a> .</p>
<h1 id="source-code">Source Code</h1>
<p>Source code is available <a
target="_blank" rel="noopener" href="https://github.com/finisky/finicounter">here</a> .</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">Related Posts</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/finicounterimpl/" rel="bookmark">FiniCounter: 静态网站访问量统计工具</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/hexormleancloud/" rel="bookmark">Hexo去LeanCloud依赖</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/hexowaline/" rel="bookmark">Hexo使用Waline评论系统</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/customizecategorybyextension/" rel="bookmark">Hexo添加自定义分类菜单项并定制页面布局(简洁版)</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/simplestblogroll.en/" rel="bookmark">Customize Hexo Blogroll Page</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Hexo/" rel="tag"># Hexo</a>
              <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
              <a href="/tags/NexT/" rel="tag"># NexT</a>
              <a href="/tags/Hexo-Extension/" rel="tag"># Hexo Extension</a>
              <a href="/tags/Hugo/" rel="tag"># Hugo</a>
              <a href="/tags/Serverless/" rel="tag"># Serverless</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/finicounterimpl/" rel="prev" title="FiniCounter: 静态网站访问量统计工具">
                  <i class="fa fa-chevron-left"></i> FiniCounter: 静态网站访问量统计工具
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/hexormleancloud/" rel="next" title="Hexo去LeanCloud依赖">
                  Hexo去LeanCloud依赖 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">finisky</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div><div><span><a href="https://finicounter.vercel.app/" target="_blank">Total Pageview:</a></span><span id="finicount_views" style="display:inline;padding-left:5px;"></span><div> <script async src="//finicounter.vercel.app/finicounter.js"></script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.1.4/es5/tex-mml-chtml.js","integrity":"sha256-ncNI9OXOS5Ek4tzVYiOMmN/KKCPZ6V0Cpv2P/zHntiA="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"en-US","enable":true,"serverURL":"https://finiskycomments.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":true,"pageSize":10,"el":"#waline","comment":true,"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","path":"/finicounterimpl.en/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

<script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
