<!DOCTYPE html>
<html lang="en">
<head><!-- hexo injector head_begin start --><!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-K4DEGPDYSW"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag("js", new Date()); gtag("config", "G-K4DEGPDYSW"); </script><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png">
  <link rel="mask-icon" href="/images/logo.png" color="#222">
  <meta name="google-site-verification" content="oFhcvcGsjsTY5AFUaI-ezbn7-bel9NrdUNpeQfwZSwI">
  <meta name="msvalidate.01" content="F8E2F274161B653649F8818FD127CE87">
  <meta name="yandex-verification" content="f6d91994ba785a63">
  <meta name="baidu-site-verification" content="code-nNL5JO7sPl">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"finisky.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Lightsquid is a handy log analyzer for squid proxy. However, the project is not maintained since 2009. Today, I found lightsquid doesn&#39;t work in 2021. Why?">
<meta property="og:type" content="article">
<meta property="og:title" content="Lightsquid Stop Working in 2021">
<meta property="og:url" content="https://finisky.github.io/2021/01/03/lightsquidhardcodeyear.en/index.html">
<meta property="og:site_name" content="Finisky Garden">
<meta property="og:description" content="Lightsquid is a handy log analyzer for squid proxy. However, the project is not maintained since 2009. Today, I found lightsquid doesn&#39;t work in 2021. Why?">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-03T15:30:03.000Z">
<meta property="article:modified_time" content="2023-01-24T14:30:12.000Z">
<meta property="article:author" content="finisky">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://finisky.github.io/2021/01/03/lightsquidhardcodeyear.en/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://finisky.github.io/2021/01/03/lightsquidhardcodeyear.en/","path":"/2021/01/03/lightsquidhardcodeyear.en/","title":"Lightsquid Stop Working in 2021"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Lightsquid Stop Working in 2021 | Finisky Garden</title>
  







<link rel="dns-prefetch" href="https://comments.finisky.eu.org">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><script type="text/javascript"> function downloadJsAtOnload() { setTimeout(function downloadJs() { var element = document.createElement("script"); element.setAttribute("data-ad-client", "ca-pub-2660281922577700"); element.async = true; element.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"; document.body.appendChild(element); }, 5000); }; if (window.addEventListener) window.addEventListener("load", downloadJsAtOnload, false); else if (window.attachEvent) window.attachEvent("onload", downloadJsAtOnload); else window.onload = downloadJsAtOnload; </script><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Finisky Garden" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Finisky Garden</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">NLP, 软件工程, 产品设计</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-nlp"><a href="/tags/NLP/" rel="section"><i class="fa fa-language fa-fw"></i>NLP</a></li><li class="menu-item menu-item-mongodb"><a href="/categories/MongoDB/" rel="section"><i class="fas fa-database fa-fw"></i>MongoDB</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-分类"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-友链"><a href="/links/" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-关于"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#lightsquid-error"><span class="nav-number">1.</span> <span class="nav-text">Lightsquid Error</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#analyze-the-problem"><span class="nav-number">2.</span> <span class="nav-text">Analyze the Problem</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#first-issue"><span class="nav-number">2.1.</span> <span class="nav-text">First Issue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#second-issue"><span class="nav-number">2.2.</span> <span class="nav-text">Second Issue</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#summary"><span class="nav-number">3.</span> <span class="nav-text">Summary</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="finisky"
      src="/images/qrcode.jpg">
  <p class="site-author-name" itemprop="name">扫码关注公众号</p>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">221</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    Related Posts
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2020/09/01/perlcgi.en/" rel="bookmark">
        <time class="popular-posts-time">2020-09-01</time>
        <br>
      Can't locate CGI.pm in @INC
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/en/could-not-find-a-version-that-satisfies-the-requirement-solution/" rel="bookmark">
        <time class="popular-posts-time">2023-05-10</time>
        <br>
      ERROR: Could not find a version that satisfies the requirement Solution
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/en/chrome-using-proxy-dns-is-done-client-side-or-proxy-side/" rel="bookmark">
        <time class="popular-posts-time">2022-11-27</time>
        <br>
      When Using Proxy in Chrome, DNS Is Performed on Which Side?
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/en/git-is-case-sensitive-while-file-system-is-not/" rel="bookmark">
        <time class="popular-posts-time">2022-11-16</time>
        <br>
      Git reset --hard Not Working: File System Is Not Case Sensitive
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/changepermalinkformat.en/" rel="bookmark">
        <time class="popular-posts-time">2021-06-15</time>
        <br>
      Hexo Change Permanent Link Format With Backward Compatibility
      </a>
    </li>
  </ul>

          </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://finisky.github.io/2021/01/03/lightsquidhardcodeyear.en/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qrcode.jpg">
      <meta itemprop="name" content="finisky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finisky Garden">
      <meta itemprop="description" content="互联网那些事儿：NLP, 软件工程, 产品设计">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Lightsquid Stop Working in 2021 | Finisky Garden">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Lightsquid Stop Working in 2021
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-01-03 23:30:03" itemprop="dateCreated datePublished" datetime="2021-01-03T23:30:03+08:00">2021-01-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-24 22:30:12" itemprop="dateModified" datetime="2023-01-24T22:30:12+08:00">2023-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">评论: </span>
  
    <a title="waline" href="/2021/01/03/lightsquidhardcodeyear.en/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2021/01/03/lightsquidhardcodeyear.en/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-item" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="waline-pageview-count" data-path="/2021/01/03/lightsquidhardcodeyear.en/"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><a target="_blank" rel="noopener" href="http://lightsquid.sourceforge.net/">Lightsquid</a> is a
handy log analyzer for squid proxy. However, the project is not
maintained since 2009.</p>
<p>Today, I found lightsquid doesn't work in 2021. Why?</p>
<span id="more"></span>
<h1 id="lightsquid-error">Lightsquid Error</h1>
<p>When I run lightparser, the output looks like this: <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ ./lightparser.pl access.log.66666
<span class="token operator">>></span><span class="token operator">></span> use <span class="token function">file</span> :: /var/log/squid/access.log.66666
run TIME: <span class="token number">1</span> sec
LightSquid parser statistic report

                 <span class="token number">3312</span> lines processed <span class="token punctuation">(</span>average <span class="token number">3312.00</span> lines per second<span class="token punctuation">)</span>
                    <span class="token number">0</span> lines parsed
                    <span class="token number">0</span> lines recovered
                    <span class="token number">0</span> lines notrecovered
                    <span class="token number">0</span> lines skiped by bad year
                 <span class="token number">3312</span> lines skiped by <span class="token function">date</span> filter
                    <span class="token number">0</span> lines skiped by Denied filter
                    <span class="token number">0</span> lines skiped by skipURL filter

WARNING <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>, parsed <span class="token number">0</span> lines from total <span class="token builtin class-name">:</span> <span class="token number">3312</span>
please check confiuration <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
may be wrong log <span class="token function">format</span> selected ?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>Seems that all lines are filtered by the date filter. I double
checked the log format and make sure it is correct and the same with
previous days.</p>
<h1 id="analyze-the-problem">Analyze the Problem</h1>
<p>Look at this piece of code (I am a Perl layman): <a
target="_blank" rel="noopener" href="https://github.com/aleksey200505/lightsquid/blob/master/lightparser.pl">here</a></p>
<pre class="line-numbers language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$filterdatestop</span> <span class="token operator">=</span>timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">1900</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token variable">$fToday</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">eq</span> <span class="token string">"today"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$fToday</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">eq</span> <span class="token string">"yesterday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$fToday</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token punctuation">(</span><span class="token variable">$sec</span><span class="token punctuation">,</span><span class="token variable">$min</span><span class="token punctuation">,</span><span class="token variable">$hour</span><span class="token punctuation">,</span><span class="token variable">$mday</span><span class="token punctuation">,</span><span class="token variable">$mon</span><span class="token punctuation">,</span><span class="token variable">$year</span><span class="token punctuation">,</span><span class="token variable">$wday</span><span class="token punctuation">,</span><span class="token variable">$yday</span><span class="token punctuation">,</span><span class="token variable">$isdst</span><span class="token punctuation">)</span> <span class="token operator">=</span> localtime<span class="token punctuation">;</span>

   <span class="token variable">$filterdate</span><span class="token operator">=</span>sprintf<span class="token punctuation">(</span><span class="token string">"%04d%02d%02d"</span><span class="token punctuation">,</span><span class="token variable">$year</span><span class="token operator">+</span><span class="token number">1900</span><span class="token punctuation">,</span><span class="token variable">$mon</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$mday</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestart</span><span class="token operator">=</span>timelocal<span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$mday</span><span class="token punctuation">,</span><span class="token variable">$mon</span><span class="token punctuation">,</span><span class="token variable">$year</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestop</span> <span class="token operator">=</span>timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token variable">$mday</span><span class="token punctuation">,</span><span class="token variable">$mon</span><span class="token punctuation">,</span><span class="token variable">$year</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">print</span> <span class="token string">">>> filter today: $filterdate\n"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">eq</span> <span class="token string">"yesterday"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$filterdatestart</span><span class="token operator">=</span><span class="token variable">$filterdatestart</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token variable">*60</span><span class="token variable">*60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestop</span> <span class="token operator">=</span><span class="token variable">$filterdatestop</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token variable">*60</span><span class="token variable">*60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">(</span><span class="token variable">$sec</span><span class="token punctuation">,</span><span class="token variable">$min</span><span class="token punctuation">,</span><span class="token variable">$hour</span><span class="token punctuation">,</span><span class="token variable">$mday</span><span class="token punctuation">,</span><span class="token variable">$mon</span><span class="token punctuation">,</span><span class="token variable">$year</span><span class="token punctuation">,</span><span class="token variable">$wday</span><span class="token punctuation">,</span><span class="token variable">$yday</span><span class="token punctuation">,</span><span class="token variable">$isdst</span><span class="token punctuation">)</span> <span class="token operator">=</span> localtime<span class="token punctuation">(</span><span class="token variable">$filterdatestart</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdate</span><span class="token operator">=</span>sprintf<span class="token punctuation">(</span><span class="token string">"%04d%02d%02d"</span><span class="token punctuation">,</span><span class="token variable">$year</span><span class="token operator">+</span><span class="token number">1900</span><span class="token punctuation">,</span><span class="token variable">$mon</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$mday</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
   <span class="token keyword">print</span> <span class="token string">">>> filter yesterday: $filterdate\n"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/^(\d\d\d\d)(\d\d)(\d\d)$/</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$filterdate</span><span class="token operator">=</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestart</span><span class="token operator">=</span>timelocal<span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$3</span><span class="token punctuation">,</span><span class="token variable">$2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestop</span> <span class="token operator">=</span>timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token variable">$3</span><span class="token punctuation">,</span><span class="token variable">$2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">print</span> <span class="token string">">>> filter date:	$filterdate\n"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/access\.log\.(\d)/</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$filename</span><span class="token operator">=</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$catname</span><span class="token operator">=</span><span class="token string">"zcat"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/\.gz$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$catname</span><span class="token operator">=</span><span class="token string">"bzcat"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/\.bz2$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">print</span> <span class="token string">">>> use file :: $logpath/$filename\n"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>

	   <span class="token comment">#speed optimization for FILTERDATE mode</span>
	   <span class="token variable">$Ltimestamp</span><span class="token operator">=</span>substr <span class="token variable">$_</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">;</span>
	   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$Ltimestamp</span><span class="token operator">&lt;</span><span class="token variable">$filterdatestart</span> <span class="token operator">or</span> <span class="token variable">$Ltimestamp</span><span class="token operator">></span><span class="token variable">$filterdatestop</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		  <span class="token keyword">print</span> <span class="token string">">>>> skipDafteFilter URL $Lurl\n$_"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug2</span> <span class="token operator">>=</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		  <span class="token variable">$skipfilterdatecntr</span><span class="token operator">++</span><span class="token punctuation">;</span>
		  <span class="token keyword">next</span><span class="token punctuation">;</span>
	   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Found two issues:</p>
<ol type="1">
<li>A hardcode <code>2020</code> in <code>$filterdatestop</code> which
makes lightsquid not work in 2021</li>
<li><code>today</code> argument cannot work with customized file at the
same time</li>
</ol>
<h2 id="first-issue">First Issue</h2>
<p>Obviously, <code>$filterdatestop</code> is the culprit:
<pre class="line-numbers language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$filterdatestop</span> <span class="token operator">=</span>timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">1900</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>A quick fix is to change the hardcoded <code>2020</code> to
<code>2100</code>. It seems that the month and year parameter are
weird...</p>
<p>I read the document of <a
target="_blank" rel="noopener" href="https://perldoc.perl.org/Time::Local">Perl's "Time::Local"</a> and
found that the design is really complex and hard to understand
(personally I think it is anti-pattern, why not make it a simple design
which supports only absolute year?):</p>
<blockquote><ul>
<li>Years greater than 999 are interpreted as being the actual year,
rather than the offset from 1900. Thus, 1964 would indicate the year
Martin Luther King won the Nobel prize, not the year 3864.</li>
<li>Years in the range 100..999 are interpreted as offset from 1900, so
that 112 indicates 2012. This rule also applies to years less than zero
(but see note below regarding date range).</li>
<li>Years in the range 0..99 are interpreted as shorthand for years in
the rolling "current century," defined as 50 years on either side of the
current year. Thus, today, in 1999, 0 would refer to 2000, and 45 to
2045, but 55 would refer to 1955. Twenty years from now, 55 would
instead refer to 2055. This is messy, but matches the way people
currently think about two digit dates. Whenever possible, use an
absolute four digit year instead.</li>
</ul>
</blockquote>
<p>Then I try to understand what these lines means: <pre class="line-numbers language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">use</span> Time<span class="token punctuation">:</span><span class="token punctuation">:</span>Local<span class="token punctuation">;</span>

<span class="token keyword">my</span> <span class="token variable">$date1</span> <span class="token operator">=</span> timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">1900</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">my</span> <span class="token variable">$date2</span> <span class="token operator">=</span> timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">1900</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">my</span> <span class="token variable">$date3</span> <span class="token operator">=</span> timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">print</span> <span class="token string">"$date1\n"</span><span class="token punctuation">;</span>
<span class="token keyword">print</span> <span class="token string">"$date2\n"</span><span class="token punctuation">;</span>
<span class="token keyword">print</span> <span class="token string">"$date3\n"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>Output: <pre class="line-numbers language-none"><code class="language-none">1609430399
1609431399
1609430399<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>The solution is easy, change this line to(note that the month is zero
indexed (0..11)), and now it works until 2100: <pre class="line-numbers language-perl" data-language="perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$filterdatestop</span> <span class="token operator">=</span>timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2100</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<h2 id="second-issue">Second Issue</h2>
<p>Another problem is that <code>today</code> argument cannot work with
customized filename: <pre class="line-numbers language-perl" data-language="perl"><code class="language-perl"><span class="token variable">$fToday</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">eq</span> <span class="token string">"today"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$fToday</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">eq</span> <span class="token string">"yesterday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$fToday</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token operator">...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">eq</span> <span class="token string">"yesterday"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token operator">...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/^(\d\d\d\d)(\d\d)(\d\d)$/</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$filterdate</span><span class="token operator">=</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestart</span><span class="token operator">=</span>timelocal<span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$3</span><span class="token punctuation">,</span><span class="token variable">$2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$filterdatestop</span> <span class="token operator">=</span>timelocal<span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token variable">$3</span><span class="token punctuation">,</span><span class="token variable">$2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">print</span> <span class="token string">">>> filter date:	$filterdate\n"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/access\.log\.(\d)/</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token variable">$filename</span><span class="token operator">=</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$catname</span><span class="token operator">=</span><span class="token string">"zcat"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/\.gz$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$catname</span><span class="token operator">=</span><span class="token string">"bzcat"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=~</span> <span class="token regex">m/\.bz2$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">print</span> <span class="token string">">>> use file :: $logpath/$filename\n"</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> Apparently, only one argument
<code>ARGV[0]</code> is applied. If you wrote the command like this and
not fixed the first issue: <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$./lightparser.pl access.log.66666 today<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> or <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$./lightparser.pl today access.log.66666<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> You will
encounter the "parsed 0 lines" error.</p>
<h1 id="summary">Summary</h1>
<p>Just fix the first issue and you will make lightsquid works longer
:-) <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ ./lightparser.pl access.log.66666
<span class="token operator">>></span><span class="token operator">></span> use <span class="token function">file</span> :: /var/log/squid/access.log.66666
<span class="token operator">>></span><span class="token operator">></span> Make Report <span class="token number">20210102</span> <span class="token punctuation">(</span><span class="token number">1577</span> - log line parsed<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> Make Report <span class="token number">20210103</span> <span class="token punctuation">(</span><span class="token number">1572</span> - log line parsed<span class="token punctuation">)</span>
run TIME: <span class="token number">1</span> sec
LightSquid parser statistic report

                 <span class="token number">3312</span> lines processed <span class="token punctuation">(</span>average <span class="token number">3312.00</span> lines per second<span class="token punctuation">)</span>
                 <span class="token number">3149</span> lines parsed
                    <span class="token number">0</span> lines recovered
                    <span class="token number">0</span> lines notrecovered
                    <span class="token number">0</span> lines skiped by bad year
                    <span class="token number">0</span> lines skiped by <span class="token function">date</span> filter
                  <span class="token number">163</span> lines skiped by Denied filter
                    <span class="token number">0</span> lines skiped by skipURL filter
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>Fixed version: https://github.com/finisky/lightsquid-1.8.1</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12/26/mongodbomcreateshardedcluster.en/" rel="prev" title="Deploy MongoDB Sharded Cluster by Ops Manager">
                  <i class="fa fa-chevron-left"></i> Deploy MongoDB Sharded Cluster by Ops Manager
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/01/13/dontuseloadbalancerinfrontofmongos.en/" rel="next" title="Don't Use Load Balancer In front of Mongos">
                  Don't Use Load Balancer In front of Mongos <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">finisky</span>
</div><div><span class="post-meta-item-icon"><i class="far fa-eye"></i></span><span><a href="https://finicounter.eu.org/" target="_blank">Total Views</a>:</span><span id="finicount_views" style="display:inline;padding-left:5px;"></span><div> <script async src="//finicounter.eu.org/finicounter.js"></script>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/finisky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"en","enable":true,"serverURL":"https://comments.finisky.eu.org","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":true,"pageSize":10,"el":"#waline","comment":true,"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","path":"/2021/01/03/lightsquidhardcodeyear.en/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body>
</html>
